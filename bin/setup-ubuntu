#!/usr/bin/env bash

set -euo pipefail

sudo pam-auth-update --enable fprintd

sudo apt purge fonts-noto-core
sudo apt install fonts-ubuntu-classic
sudo apt install \
    flatpak \
    podman \
    virt-manager

sudo flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo

sudo snap install --classic \
    code
sudo snap install \
    lxd \
    spotify

nix --extra-experimental-features 'flakes nix-command' profile add \
    nixpkgs#bat \
    nixpkgs#chezmoi \
    nixpkgs#diffoscopeMinimal \
    nixpkgs#diff-so-fancy \
    nixpkgs#dos2unix \
    nixpkgs#eza \
    nixpkgs#fish \
    nixpkgs#fzf \
    nixpkgs#git \
    nixpkgs#htop \
    nixpkgs#starship \
    nixpkgs#trash-cli \
    nixpkgs#wl-clipboard \
    nixpkgs#zoxide

if ! test -d ~/.local/share/fonts; then
    cd /tmp
    mkdir -p ~/.local/share/fonts
    wget https://github.com/ryanoasis/nerd-fonts/releases/download/v3.4.0/UbuntuMono.zip
    unzip -o UbuntuMono.zip -d ~/.local/share/fonts
fi

if ! test -d ~/.local/share/chezmoi; then
    chezmoi -- init --apply dawidd6
fi

systemctl --user daemon-reload
systemctl --user enable --now fish-extra-completions.path

gsettings set org.gnome.desktop.interface font-name 'Ubuntu 11'
gsettings set org.gnome.desktop.interface monospace-font-name 'UbuntuMono Nerd Font 13'
gsettings set org.gnome.desktop.interface document-font-name 'Sans 11'
gsettings set org.gnome.desktop.wm.preferences titlebar-font 'Ubuntu Bold 11'
